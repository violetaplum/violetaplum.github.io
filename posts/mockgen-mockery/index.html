<!doctype html><html lang=en><head><title>Mockgen vs Mockery</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.34793ea3875bfaaa88436c36fa80f08bc736978d47b512f83f32b8acbae3a603.css integrity="sha256-NHk+o4db+qqIQ2w2+oDwi8c2l41HtRL4PzK4rLrjpgM="><link rel=icon type=image/png href=/images/site/favicon_hu_a7920c91965714cb.png><meta property="og:url" content="https://violetaplum.github.io/posts/mockgen-mockery/"><meta property="og:site_name" content="Violetaplum's Blog"><meta property="og:title" content="Mockgen vs Mockery"><meta property="og:description" content="mockgen vs mockery -> Go 백엔드 개발자를 위한 심층 분석"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-08T08:06:25+06:00"><meta property="article:modified_time" content="2020-06-08T08:06:25+06:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mockgen vs Mockery"><meta name=twitter:description content="mockgen vs mockery -> Go 백엔드 개발자를 위한 심층 분석"><meta name=description content="mockgen vs mockery -> Go 백엔드 개발자를 위한 심층 분석"><script async src="https://www.googletagmanager.com/gtag/js?id=G-H4LBG7NDFZ"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H4LBG7NDFZ")}</script><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/><img src=/images/site/main-logo_hu_77a6e5ea6e57520b.png id=logo alt=Logo>
Violetaplum's Blog</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/#home>Home</a></li><li class=nav-item><a class=nav-link href=/#about>About</a></li><li class=nav-item><a class=nav-link href=/#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/#experiences>Experiences</a></li><li class=nav-item><a class=nav-link href=/#education>Education</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>More</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/#projects>Projects</a>
<a class=dropdown-item href=/#publications>Publications</a>
<a class=dropdown-item href=/#featured-posts>Featured Posts</a>
<a class=dropdown-item href=/#recent-posts>Recent Posts</a>
<a class=dropdown-item href=/#accomplishments>Accomplishments</a>
<a class=dropdown-item href=/#achievements>Achievements</a></div></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>Posts</a></li><li class=nav-item><a class=nav-link id=note-link href=/notes>Notes</a></li><li class=nav-item><a class=nav-link href=https://toha-guides.netlify.app/posts/>Docs</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/main-logo_hu_77a6e5ea6e57520b.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu_a7920c91965714cb.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts/ data-filter=all>Posts</a></li><div class=subtree><li><a class=list-link href=/posts/introduction/ title=Introduction>Introduction</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/category/> Category</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/posts/category/sub-category/> Sub-Category</a><ul><li><a class=list-link href=/posts/category/sub-category/rich-content/ title="Rich Content">Rich Content</a></li></ul></li></ul></li><li><a class=list-link href=/posts/markdown-sample/ title="Markdown Sample">Markdown Sample</a></li><li><a class=list-link href=/posts/event-driven-account/ title="Event-Driven 뱅킹 서비스">Event-Driven 뱅킹 서비스</a></li><li><a class="active list-link" href=/posts/mockgen-mockery/ title="Mockgen vs Mockery">Mockgen vs Mockery</a></li><li><a class=list-link href=/posts/shortcodes/ title="Shortcodes Sample">Shortcodes Sample</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/gopher_hu_d0cf57b79ee1ac89.png alt="Author Image"><h5 class=author-name>Violetaplum</h5><p class=text-muted>Monday, June 8, 2020 | 4 minutes</p></div><div class=title><h1>Mockgen vs Mockery</h1></div><div class=tags><ul style=padding-left:0></ul></div><div class=post-content id=post-content><h1 id=mockgen-vs-mockery-go-백엔드-기술선택-가이드>mockgen vs mockery: Go 백엔드 기술선택 가이드</h1><h2 id=들어가며>들어가며</h2><p>마이크로서비스 아키텍처와 테스트 주도 개발(TDD)이 일반화된 현대 백엔드 개발 환경에서, 효과적인 모킹(mocking) 전략의 선택은 매우 중요합니다. 이 글에서는 Go 생태계의 대표적인 모킹 도구인 <code>mockgen</code>과 <code>mockery</code>를 실제 프로덕션 환경에서의 경험을 바탕으로 비교 분석합니다.</p><h2 id=아키텍처-관점에서의-비교>아키텍처 관점에서의 비교</h2><h3 id=mockgen의-아키텍처>mockgen의 아키텍처</h3><p>mockgen은 AST(Abstract Syntax Tree) 파싱을 기반으로 동작하며, 다음과 같은 아키텍처적 특징을 가집니다:</p><ol><li><p><strong>코드 생성 프로세스</strong></p><pre tabindex=0><code>// mockgen의 일반적인 워크플로우
source code -&gt; AST parsing -&gt; type analysis -&gt; code generation
</code></pre></li><li><p><strong>리플렉션 모드 vs 소스 모드</strong></p><ul><li>소스 모드: 직접적인 소스 코드 분석</li><li>리플렉션 모드: 런타임 타입 정보 활용</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 소스 모드 예시</span>
</span></span><span style=display:flex><span>mockgen -source<span style=color:#f92672>=</span>repository.go -destination<span style=color:#f92672>=</span>mock_repository.go
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 리플렉션 모드 예시</span>
</span></span><span style=display:flex><span>mockgen github.com/org/project Repository
</span></span></code></pre></div></li></ol><h3 id=mockery의-아키텍처>mockery의 아키텍처</h3><p>mockery는 더 유연한 템플릿 기반 접근 방식을 채택했습니다:</p><ol><li><p><strong>코드 생성 프로세스</strong></p><pre tabindex=0><code>// mockery의 워크플로우
source code -&gt; type parsing -&gt; template rendering -&gt; code generation
</code></pre></li><li><p><strong>패키지 탐색 전략</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># .mockery.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>with-expecter</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#f92672>packages</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>github.com/org/project</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>interfaces</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Repository</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>with-expecter</span>: <span style=color:#66d9ef>false</span>
</span></span></code></pre></div></li></ol><h2 id=실제-프로덕션-환경에서의-비교>실제 프로덕션 환경에서의 비교</h2><h3 id=대규모-마이크로서비스-환경>대규모 마이크로서비스 환경</h3><ol><li><p><strong>서비스 간 통신 모킹</strong></p><pre tabindex=0><code>// mockgen 사용 시
type GRPCClient interface {
    Send(ctx context.Context, req *pb.Request) (*pb.Response, error)
}

// mockery 사용 시 - Expecter 패턴 활용
func (m *MockGRPCClient) EXPECT() *MockGRPCClientExpectations {
    return &amp;MockGRPCClientExpectations{mock: m}
}
</code></pre></li><li><p><strong>데이터베이스 트랜잭션 처리</strong></p><pre tabindex=0><code>// 복잡한 트랜잭션 시나리오에서의 모킹
type TxManager interface {
    BeginTx(ctx context.Context, opts *sql.TxOptions) (*sql.Tx, error)
    CommitTx(tx *sql.Tx) error
    RollbackTx(tx *sql.Tx) error
}
</code></pre></li></ol><h3 id=성능-임팩트-분석>성능 임팩트 분석</h3><p>실제 대규모 프로젝트(100만 라인 이상)에서의 벤치마크 결과:</p><pre tabindex=0><code>mockgen:
- 모의 객체 생성 시간: ~0.3ms
- 메모리 사용량: ~2MB
- 테스트 실행 오버헤드: 미미함

mockery:
- 모의 객체 생성 시간: ~0.4ms
- 메모리 사용량: ~3MB
- 테스트 실행 오버헤드: 약간 있음 (Expecter 패턴 때문)
</code></pre><h3 id=테스트-코드-품질>테스트 코드 품질</h3><ol><li><p><strong>테스트 가독성</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// mockgen 스타일</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mock</span>.<span style=color:#a6e22e>EXPECT</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GetUser</span>(<span style=color:#a6e22e>gomock</span>.<span style=color:#a6e22e>Any</span>()).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Return</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{}, <span style=color:#66d9ef>nil</span>).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Times</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// mockery 스타일</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mock</span>.<span style=color:#a6e22e>EXPECT</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GetUser</span>(<span style=color:#a6e22e>mock</span>.<span style=color:#a6e22e>Anything</span>).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Return</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{}, <span style=color:#66d9ef>nil</span>).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Once</span>()
</span></span></code></pre></div></li><li><p><strong>에러 처리와 디버깅</strong></p><pre tabindex=0><code>// mockgen의 에러 출력
&#34;Unexpected call to ...&#34;

// mockery의 에러 출력
&#34;FAIL: expected call at least once, got 0 times...&#34;
</code></pre></li></ol><h2 id=실전-사용-시나리오-및-패턴>실전 사용 시나리오 및 패턴</h2><h3 id=1-외부-api-통합-테스트>1. 외부 API 통합 테스트</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// mockery를 사용한 HTTP 클라이언트 모킹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>HTTPClient</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Response</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 테스트 코드</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mock</span>.<span style=color:#a6e22e>EXPECT</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>mock</span>.<span style=color:#a6e22e>MatchedBy</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>Path</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;/api/v1/users&#34;</span>
</span></span><span style=display:flex><span>    })).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Return</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Response</span>{<span style=color:#f92672>...</span>}, <span style=color:#66d9ef>nil</span>)
</span></span></code></pre></div><h3 id=2-캐시-레이어-모킹>2. 캐시 레이어 모킹</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// mockgen을 사용한 Redis 클라이언트 모킹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CacheClient</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>key</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>interface</span>{}, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Set</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>key</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>value</span> <span style=color:#66d9ef>interface</span>{}, <span style=color:#a6e22e>expiration</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ctrl</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gomock</span>.<span style=color:#a6e22e>NewController</span>(<span style=color:#a6e22e>t</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>mockCache</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewMockCacheClient</span>(<span style=color:#a6e22e>ctrl</span>)
</span></span></code></pre></div><h3 id=3-이벤트-기반-시스템-테스트>3. 이벤트 기반 시스템 테스트</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// mockery의 Expecter 패턴을 활용한 이벤트 발행자 모킹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>EventPublisher</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Publish</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>topic</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>event</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mockPublisher</span>.<span style=color:#a6e22e>EXPECT</span>().
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Publish</span>(<span style=color:#a6e22e>mock</span>.<span style=color:#a6e22e>Anything</span>, <span style=color:#e6db74>&#34;user.created&#34;</span>, <span style=color:#a6e22e>mock</span>.<span style=color:#a6e22e>MatchedBy</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>e</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>event</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>e</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>UserCreatedEvent</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ok</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>UserID</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    })).
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Return</span>(<span style=color:#66d9ef>nil</span>)
</span></span></code></pre></div><h2 id=도구-선택-가이드>도구 선택 가이드</h2><h3 id=mockgen-선택이-좋은-경우>mockgen 선택이 좋은 경우</h3><ol><li><p><strong>마이크로서비스 초기 개발 단계</strong></p><ul><li>빠른 설정과 간단한 인터페이스 모킹이 필요할 때</li><li>팀이 Go에 익숙하지 않을 때</li></ul></li><li><p><strong>레거시 시스템 마이그레이션</strong></p><ul><li>안정적인 코드 생성이 중요할 때</li><li>Google의 지원이 신뢰성 있게 느껴질 때</li></ul></li></ol><h3 id=mockery-선택이-좋은-경우>mockery 선택이 좋은 경우</h3><ol><li><p><strong>복잡한 도메인 로직 테스트</strong></p><ul><li>상세한 매처(matcher) 설정이 필요할 때</li><li>테스트 시나리오가 복잡할 때</li></ul></li><li><p><strong>대규모 팀 협업</strong></p><ul><li>커스텀 템플릿으로 일관된 테스트 스타일 유지가 필요할 때</li><li>테스트 코드 재사용성이 중요할 때</li></ul></li></ol><h2 id=현업에서의-실제-사용-팁>현업에서의 실제 사용 팁</h2><h3 id=1-cicd-파이프라인-통합>1. CI/CD 파이프라인 통합</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># GitHub Actions 예시</span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Generate mocks</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          go install github.com/vektra/mockery/v2@latest
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          go generate ./...</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Run tests</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>go test ./... -v</span>
</span></span></code></pre></div><h3 id=2-모킹-전략-최적화>2. 모킹 전략 최적화</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 인터페이스 분리 원칙 적용</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserReader</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GetUser</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>string</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserWriter</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>SaveUser</span>(<span style=color:#a6e22e>user</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>User</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 테스트에 필요한 것만 모킹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserRepository</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>UserReader</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>UserWriter</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-테스트-코드-유지보수>3. 테스트 코드 유지보수</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 테스트 헬퍼 함수 활용</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setupMockRepository</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>MockRepository</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Helper</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctrl</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gomock</span>.<span style=color:#a6e22e>NewController</span>(<span style=color:#a6e22e>t</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mock</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewMockRepository</span>(<span style=color:#a6e22e>ctrl</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>mock</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=결론>결론</h2><p>두 도구 모두 훌륭하지만, 프로젝트의 특성과 팀의 상황에 따라 선택이 달라질 수 있습니다:</p><ul><li><strong>mockgen</strong>: 안정성과 단순성이 중요한 프로젝트</li><li><strong>mockery</strong>: 유연성과 확장성이 필요한 프로젝트</li></ul><p>특히 주목할 점은:</p><ol><li>mockery의 Expecter 패턴은 테스트 코드의 재사용성을 크게 향상</li><li>mockgen의 안정적인 코드 생성은 CI/CD 파이프라인에서 큰 장점</li><li>두 도구 모두 성능 차이는 실제 프로덕션 환경에서 무시할 만한 수준</li></ol><p>마지막으로, 어떤 도구를 선택하든 **테스트 용이성(testability)**을 고려한 인터페이스 설계가 가장 중요합니다.</p><h2 id=참고-자료>참고 자료</h2><ul><li><a href=https://github.com/golang/mock/tree/master/docs target=_blank rel=noopener>golang/mock 디자인 문서</a></li><li><a href=https://vektra.github.io/mockery/tips/ target=_blank rel=noopener>mockery의 Best Practices</a></li><li><a href=https://golang.org/doc/testing target=_blank rel=noopener>Effective Go Testing Strategies</a></li></ul></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn icon-button bg-facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fvioletaplum.github.io%2fposts%2fmockgen-mockery%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2fvioletaplum.github.io%2fposts%2fmockgen-mockery%2f&text=Mockgen%20vs%20Mockery&via=Violetaplum%27s%20Blog" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn icon-button bg-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fvioletaplum.github.io%2fposts%2fmockgen-mockery%2f&title=Mockgen%20vs%20Mockery" target=_blank><i class="fab fa-reddit"></i>
</a><a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fvioletaplum.github.io%2fposts%2fmockgen-mockery%2f&title=Mockgen%20vs%20Mockery" target=_blank><i class="fab fa-linkedin"></i>
</a><a class="btn icon-button bg-whatsapp" href="https://api.whatsapp.com/send?text=Mockgen%20vs%20Mockery https%3a%2f%2fvioletaplum.github.io%2fposts%2fmockgen-mockery%2f" target=_blank><i class="fab fa-whatsapp"></i>
</a><a class="btn icon-button" href="mailto:?subject=Mockgen%20vs%20Mockery&body=https%3a%2f%2fvioletaplum.github.io%2fposts%2fmockgen-mockery%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/hugo-toha/hugo-toha.github.io/edit/main/content/posts/mockgen-mockery/index.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/event-driven-account/ title="Event-Driven 뱅킹 서비스 구현하기: Go와 CQRS 패턴" class="btn filled-button"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>Event-Driven 뱅킹 서비스 구현하기: Go와 CQRS 패턴</div></a></div><div class="col-md-6 next-article"><a href=/posts/shortcodes/ title="Shortcodes Samples" class="btn filled-button"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Shortcodes Samples</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#들어가며>들어가며</a></li><li><a href=#아키텍처-관점에서의-비교>아키텍처 관점에서의 비교</a><ul><li><a href=#mockgen의-아키텍처>mockgen의 아키텍처</a></li><li><a href=#mockery의-아키텍처>mockery의 아키텍처</a></li></ul></li><li><a href=#실제-프로덕션-환경에서의-비교>실제 프로덕션 환경에서의 비교</a><ul><li><a href=#대규모-마이크로서비스-환경>대규모 마이크로서비스 환경</a></li><li><a href=#성능-임팩트-분석>성능 임팩트 분석</a></li><li><a href=#테스트-코드-품질>테스트 코드 품질</a></li></ul></li><li><a href=#실전-사용-시나리오-및-패턴>실전 사용 시나리오 및 패턴</a><ul><li><a href=#1-외부-api-통합-테스트>1. 외부 API 통합 테스트</a></li><li><a href=#2-캐시-레이어-모킹>2. 캐시 레이어 모킹</a></li><li><a href=#3-이벤트-기반-시스템-테스트>3. 이벤트 기반 시스템 테스트</a></li></ul></li><li><a href=#도구-선택-가이드>도구 선택 가이드</a><ul><li><a href=#mockgen-선택이-좋은-경우>mockgen 선택이 좋은 경우</a></li><li><a href=#mockery-선택이-좋은-경우>mockery 선택이 좋은 경우</a></li></ul></li><li><a href=#현업에서의-실제-사용-팁>현업에서의 실제 사용 팁</a><ul><li><a href=#1-cicd-파이프라인-통합>1. CI/CD 파이프라인 통합</a></li><li><a href=#2-모킹-전략-최적화>2. 모킹 전략 최적화</a></li><li><a href=#3-테스트-코드-유지보수>3. 테스트 코드 유지보수</a></li></ul></li><li><a href=#결론>결론</a></li><li><a href=#참고-자료>참고 자료</a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://violetaplum.github.io/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://violetaplum.github.io/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://violetaplum.github.io/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://violetaplum.github.io/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://violetaplum.github.io/#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://violetaplum.github.io/#publications>Publications</a></li><li class=nav-item><a class=smooth-scroll href=https://violetaplum.github.io/#featured-posts>Featured Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://violetaplum.github.io/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://violetaplum.github.io/#accomplishments>Accomplishments</a></li><li class=nav-item><a class=smooth-scroll href=https://violetaplum.github.io/#achievements>Achievements</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:violetaplume@gmail.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>violetaplume@gmail.com</span></a></li><li><a href=https://github.com/violetaplum target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>violetaplum</span></a></li><li><a href=tel:+0149152532 target=_blank rel=noopener><span><i class="fas fa-phone-alt"></i></span> <span>+0149152532</span></a></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>Liability Notice:</strong> This theme is under MIT license. So, you can use it for non-commercial, commercial, or private uses. You can modify or distribute the theme without requiring any permission from the theme author. However, the theme author does not provide any warranty or takes any liability for any issue with the theme.</p></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu_b3360284c55cf72d.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2020 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.79f6ab338689c40f954fc43ca38b3419fbee28d10f3fa978bdd11b707a08c46f.js integrity="sha256-efarM4aJxA+VT8Q8o4s0GfvuKNEPP6l4vdEbcHoIxG8=" defer></script></body></html>